# Example Caddy Configuration for Comma Connect
# Place this in your Caddyfile

comma.example.com {
    # Automatic HTTPS with Let's Encrypt

    # Frontend - Main application
    handle /* {
        reverse_proxy localhost:3000
    }

    # API endpoints
    handle /api/* {
        reverse_proxy localhost:8000
    }

    # WebSocket for Athena
    handle /ws/* {
        reverse_proxy localhost:8001
    }

    # Map tiles
    handle /tiles/* {
        reverse_proxy localhost:8080
    }

    # Routing service
    handle /route/* {
        reverse_proxy localhost:5000
    }

    # Optional: Add rate limiting
    rate_limit {
        zone api {
            key {remote_host}
            events 100
            window 1m
        }
    }

    # Optional: Add security headers
    header {
        # Enable HSTS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        # XSS Protection
        X-Content-Type-Options "nosniff"
        # Referrer Policy
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Optional: Enable compression
    encode gzip

    # Logging
    log {
        output file /var/log/caddy/comma-connect.log
        format json
    }
}

# Grafana subdomain (optional)
grafana.example.com {
    reverse_proxy localhost:3000
}

# MinIO Console subdomain (optional)
minio.example.com {
    reverse_proxy localhost:9001
}
